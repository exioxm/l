<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HYPERDRIVE: OMNI-APEX (2026 Edition)</title>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <style>
        :root { --neon: #00f2ff; --pink: #ff007f; --gold: #ffcc00; --bg: #050508; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Share Tech Mono', monospace; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; touch-action: none; }
        #canvas-wrap { position: relative; border: 2px solid #1a1a2e; box-shadow: 0 0 50px rgba(0, 242, 255, 0.1); }
        .hud { position: absolute; width: 100%; top: 0; padding: 20px; display: flex; justify-content: space-between; font-family: 'Syncopate'; font-size: 14px; pointer-events: none; text-shadow: 0 0 10px var(--neon); }
        .flow-container { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); width: 250px; height: 6px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden; border: 1px solid rgba(0,242,255,0.2); }
        #flow-bar { width: 0%; height: 100%; background: var(--neon); transition: width 0.1s; box-shadow: 0 0 15px var(--neon); }
        .msg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; width: 100%; }
        .start-btn { background: var(--neon); color: black; border: none; padding: 15px 30px; font-weight: bold; cursor: pointer; border-radius: 4px; font-family: 'Syncopate'; box-shadow: 0 0 20px var(--neon); }
    </style>
</head>
<body>

    <div id="canvas-wrap">
        <div class="hud">
            <div>CREDITS: <span id="cr">0</span></div>
            <div>DIST: <span id="dist">0</span>m</div>
        </div>
        <div id="ui-msg" class="msg">
            <h1 style="font-family: 'Syncopate'; color: var(--neon); font-size: 2rem;">HYPERDRIVE</h1>
            <button class="start-btn" onclick="startGame()">SYNC NEURAL LINK</button>
        </div>
        <div class="flow-container"><div id="flow-bar"></div></div>
        <canvas id="game"></canvas>
    </div>

    <script>
        const canvas = document.getElementById("game");
        const ctx = canvas.getContext("2d");
        canvas.width = 440; canvas.height = 660;

        // Game State
        let data = { cr: parseInt(localStorage.getItem('hd_cr')) || 0, best: 0 };
        let active = false, score = 0, flow = 0, hyper = 0, lastTime = 0, spawnAcc = 0, shake = 0;
        let p = { lane: 1, x: 200, y: 520, w: 44, h: 84, targetX: 200 };
        let entities = [];

        function startGame() {
            document.getElementById('ui-msg').style.display = 'none';
            active = true; score = 0; flow = 0; hyper = 0; entities = [];
            lastTime = performance.now();
            requestAnimationFrame(loop);
        }

        function loop(t) {
            if (!active) return;
            const dt = (t - lastTime) / 16.67; 
            lastTime = t;

            // Background & Screen Shake
            ctx.fillStyle = '#050508'; ctx.fillRect(0,0,440,660);
            ctx.save();
            if(shake > 0) { ctx.translate((Math.random()-0.5)*shake, (Math.random()-0.5)*shake); shake *= 0.8; }

            // Procedural Grid (Parallax)
            ctx.strokeStyle = hyper > 0 ? 'rgba(255,255,255,0.2)' : 'rgba(0, 242, 255, 0.05)';
            for(let i=0; i<12; i++) {
                let y = ((t * 0.5 + i * 60) % 660);
                ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(440, y); ctx.stroke();
            }

            // Player Physics
            p.targetX = (p.lane * 146) + 73 - 22;
            p.x += (p.targetX - p.x) * 0.25 * dt;

            // Neon Car Glow
            ctx.shadowBlur = hyper > 0 ? 40 : 20; 
            ctx.shadowColor = hyper > 0 ? '#fff' : '#00f2ff';
            ctx.fillStyle = hyper > 0 ? '#fff' : '#00f2ff';
            ctx.fillRect(p.x, p.y, p.w, p.h);
            ctx.shadowBlur = 0;

            // Difficulty & Spawning
            spawnAcc += dt;
            if(spawnAcc > (50 / (1 + score/5000))) {
                const isBoss = Math.random() > 0.96;
                entities.push({ 
                    lane: Math.floor(Math.random()*3), y: -160, 
                    w: isBoss ? 100 : 44, h: isBoss ? 160 : 84, 
                    type: isBoss ? 'boss' : 'car', passed: false 
                });
                spawnAcc = 0;
            }

            entities.forEach((en, i) => {
                let speed = (7 + (score/2000)) * dt;
                if(hyper > 0) { speed *= 0.4; hyper -= dt; }
                en.y += speed;

                let ex = (en.lane * 146) + 73 - (en.w/2);
                ctx.fillStyle = en.type === 'boss' ? '#ff007f' : '#1a1a2e';
                ctx.fillRect(ex, en.y, en.w, en.h);

                // Precise AABB Collision
                if(p.x < ex + en.w && p.x + p.w > ex && p.y < en.y + en.h && p.y + p.h > en.y) {
                    if (hyper <= 0) gameOver();
                }

                // Near-Miss Scoring
                if(!en.passed && en.y > p.y) {
                    en.passed = true;
                    score += 10; data.cr += (1 + Math.floor(flow/25));
                    if(Math.abs(p.x - ex) < 65) { 
                        flow = Math.min(100, flow + 20); 
                        shake = 12;
                    }
                }
                if(en.y > 660) entities.splice(i, 1);
            });

            if(flow >= 100) { hyper = 250; flow = 0; }

            ctx.restore();
            document.getElementById('cr').innerText = Math.floor(data.cr);
            document.getElementById('dist').innerText = Math.floor(score);
            document.getElementById('flow-bar').style.width = flow + "%";
            requestAnimationFrame(loop);
        }

        function gameOver() {
            active = false;
            localStorage.setItem('hd_cr', data.cr);
            document.getElementById('ui-msg').style.display = 'block';
            document.getElementById('ui-msg').innerHTML = `<h1 style="color:var(--pink)">CRITICAL FAILURE</h1><p>DISTANCE: ${score}m</p><button class="start-btn" onclick="startGame()">RE-SYNC LINK</button>`;
            if (navigator.vibrate) navigator.vibrate(200);
        }

        // Inputs
        window.addEventListener("keydown", e => {
            if(e.key === "ArrowLeft" && p.lane > 0) p.lane--;
            if(e.key === "ArrowRight" && p.lane < 2) p.lane++;
        });
        canvas.addEventListener("touchstart", e => {
            const x = e.touches[0].clientX - canvas.getBoundingClientRect().left;
            x < canvas.width / 2 ? (p.lane > 0 && p.lane--) : (p.lane < 2 && p.lane++);
        });
    </script>
</body>
</html>
