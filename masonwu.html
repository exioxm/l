<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBER DRIFT 2025: STABLE</title>
    <style>
        @import url('fonts.googleapis.com');
        body { margin: 0; background: #000; overflow: hidden; display: flex; align-items: center; justify-content: center; height: 100vh; font-family: 'Space Grotesk', sans-serif; color: #fff; }
        #core-frame { position: relative; width: 480px; height: 850px; background: #000; border: 2px solid #222; overflow: hidden; }
        canvas { display: block; filter: contrast(1.2) saturate(1.3); cursor: none; }
        .ui { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; background: rgba(0,0,0,0.95); transition: 0.5s; }
        .hidden { opacity: 0; pointer-events: none; transform: scale(1.1); }
        .title { font-family: 'Orbitron'; font-size: 55px; color: #fff; text-shadow: 0 0 20px #0ff; margin: 0; }
        .btn { margin: 10px; padding: 20px 50px; background: none; border: 2px solid #0ff; color: #0ff; font-family: 'Orbitron'; cursor: pointer; transition: 0.2s; width: 340px; font-weight: 900; }
        .btn:hover { background: #0ff; color: #000; box-shadow: 0 0 40px #0ff; }
        #hud { position: absolute; top: 30px; left: 30px; right: 30px; display: flex; justify-content: space-between; z-index: 50; color: #0ff; pointer-events: none; }
        .debug { position: absolute; bottom: 10px; left: 10px; color: #111; cursor: pointer; font-size: 10px; }
    </style>
</head>
<body>
<div id="core-frame">
    <canvas id="stage"></canvas>
    <div id="hud" class="hidden">
        <div>DIST: <span id="ui-dist" style="font-size:24px; font-weight:900;">0</span> FT</div>
        <div>CASH: $<span id="ui-cash" style="font-size:24px; font-weight:900;">0.00</span></div>
    </div>
    <div id="menu" class="ui">
        <h1 class="title">CYBER DRIFT</h1>
        <div style="font-size:12px; color:#444; letter-spacing:4px; margin-top:5px;">by ZED Productions</div>
        <button class="btn" style="margin-top:40px;" onclick="startRun()">START GAME</button>
        <div class="debug" onclick="admin()">[D]</div>
    </div>
</div>

<script>
const cv = document.getElementById('stage'), ct = cv.getContext('2d');
cv.width = 480; cv.height = 850;

let state = 'MENU', frame = 0, dist = 0, speed = 12, cash = 0;
let px = 218, tx = 218, cars = [];
const CW = 46, CH = 92;

function startRun() {
    state = 'PLAY'; dist = 0; frame = 0; speed = 12; cars = [];
    document.getElementById('menu').classList.add('hidden');
    document.getElementById('hud').classList.remove('hidden');
}

window.addEventListener('mousemove', e => {
    const r = cv.getBoundingClientRect();
    tx = e.clientX - r.left - CW/2;
});

function spawn() {
    // Spawning logic fix: ensured car X is within visible lane bounds
    cars.push({
        x: Math.random() * (cv.width - CW - 40) + 20,
        y: -200,
        c: `hsl(${Math.random()*360}, 100%, 60%)`, // Ultra-bright neon
        v: 0.7 + Math.random() * 0.4
    });
}

function update() {
    if(state !== 'PLAY') return;
    frame++; dist += speed * 0.1; cash += (speed * 0.0001); speed += 0.002;
    px += (tx - px) * 0.2;
    px = Math.max(20, Math.min(cv.width - CW - 20, px));

    if(frame % Math.max(10, Math.floor(40 - speed/2)) === 0) spawn();

    cars.forEach((c, i) => {
        c.y += speed * c.v;
        // Accurate collision hitbox
        if (px < c.x + CW - 8 && px + CW > c.x + 8 && 700 < c.y + CH - 15 && 700 + CH > c.y + 15) {
            state = 'DEAD'; setTimeout(() => location.reload(), 2000);
        }
        if(c.y > cv.height + 100) cars.splice(i, 1);
    });

    document.getElementById('ui-dist').innerText = Math.floor(dist);
    document.getElementById('ui-cash').innerText = cash.toFixed(2);
}

function drawCar(x, y, col, isP) {
    ct.save();
    ct.translate(x, y);
    // Metallic Shader Gradient
    let g = ct.createLinearGradient(0, 0, CW, 0);
    g.addColorStop(0, col); g.addColorStop(0.5, '#fff'); g.addColorStop(1, col);
    ct.fillStyle = g;
    ct.beginPath(); ct.roundRect(0, 0, CW, CH, 12); ct.fill();
    // Glass
    ct.fillStyle = '#050505';
    ct.beginPath(); ct.roundRect(6, 15, CW-12, 35, 6); ct.fill();
    // Headlights
    if(isP) {
        ct.shadowBlur = 20; ct.shadowColor = '#0ff'; ct.fillStyle = '#fff';
        ct.fillRect(4, -4, 12, 6); ct.fillRect(CW-16, -4, 12, 6);
    } else {
        ct.fillStyle = '#f00'; ct.fillRect(4, CH-2, 12, 5); ct.fillRect(CW-16, CH-2, 12, 5);
    }
    ct.restore();
}

function draw() {
    ct.fillStyle = '#020205'; ct.fillRect(0,0,cv.width,cv.height);
    // Animated Road Lines
    ct.setLineDash([40, 40]);
    ct.lineDashOffset = -frame * speed;
    ct.strokeStyle = '#111'; ct.lineWidth = 4;
    for(let i=120; i<480; i+=120) {
        ct.beginPath(); ct.moveTo(i, 0); ct.lineTo(i, cv.height); ct.stroke();
    }
    if(state === 'PLAY' || state === 'DEAD') {
        cars.forEach(c => drawCar(c.x, c.y, c.c, false));
        if(state !== 'DEAD') drawCar(px, 700, '#eee', true);
    }
}

function loop() { update(); draw(); requestAnimationFrame(loop); }
loop();

function admin() {
    if(prompt("AUTH:") === "test") { speed = 25; startRun(); }
}
</script>
</body>
</html>
