<!DOCTYPE html>
<html>
<head>
    <title>LASD: Wanted Level Command</title>
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        #game-container { position: relative; display: flex; }
        canvas { background: #1e272e; border: 4px solid #f1c40f; border-radius: 8px; cursor: crosshair; }
        .ui-top { position: absolute; top: -55px; width: 800px; display: flex; justify-content: space-between; font-size: 22px; font-weight: bold; color: #f1c40f; text-shadow: 1px 1px black; }
        #side-panel { width: 250px; background: #2c3e50; padding: 20px; border-left: 4px solid #f1c40f; height: 500px; overflow-y: auto; }
        .unit-card { background: #34495e; padding: 10px; margin-bottom: 10px; border-radius: 5px; border-left: 5px solid #f1c40f; cursor: pointer; }
        .unit-card h4 { margin: 0; font-size: 14px; }
        .unit-card p { margin: 5px 0 0; font-size: 12px; color: #bdc3c7; }
        .price { color: #2ecc71; font-weight: bold; }
        #radio-log { position: absolute; bottom: 20px; left: 20px; width: 300px; height: 100px; background: rgba(0,0,0,0.8); border: 1px solid #f1c40f; padding: 10px; font-size: 12px; color: #2ecc71; overflow-y: hidden; pointer-events: none; border-radius: 5px; }
        .dispatch-msg { margin: 0; padding: 2px 0; border-bottom: 1px solid #333; }
        #wanted-level-ui { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); color: red; font-size: 28px; background: black; padding: 5px 15px; border-radius: 5px; box-shadow: 0 0 15px red; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="ui-top">
        <span>ðŸ’° $<span id="money">1000</span></span>
        <span>ðŸš” Units: <span id="fleet-count">1</span></span>
    </div>

    <div id="wanted-level-ui">Wanted Level: <span id="wanted-level">0</span></div>

    <canvas id="cityCanvas" width="800" height="500"></canvas>

    <div id="side-panel">
        <h3 style="margin-top:0">LASD FLEET SHOP</h3>
        <div class="unit-card" onclick="buy('crown')"><h4>Crown Victoria Interceptor</h4><p>Classic reliability. <span class="price">$300</span></p></div>
        <div class="unit-card" onclick="buy('explorer')"><h4>Explorer Interceptor Utility</h4><p>Modern agile SUV. <span class="price">$500</span></p></div>
        <div class="unit-card" onclick="buy('tahoe')"><h4>Tahoe Interceptor</h4><p>Heavy pursuit power. <span class="price">$800</span></p></div>
        <div class="unit-card" onclick="buy('pierce')"><h4>Pierce Command Center</h4><p>Mobile Station. <span class="price">$2500</span></p></div>
        <div class="unit-card" onclick="buy('air')"><h4>Aero Bureau (Heli)</h4><p>Ignores buildings. <span class="price">$1500</span></p></div>
    </div>
    
    <div id="radio-log"></div>
</div>

<script>
const canvas = document.getElementById('cityCanvas');
const ctx = canvas.getContext('2d');
const tileSize = 50;
const cols = 16, rows = 10;

const cityMap = [
   ,
   ,
   ,
   ,
   ,
   ,
   ,
   ,
   ,
   
];

let money = 1000, units = [], crimes = [], frames = 0, totalEarnings = 0, wantedLevel = 0;

class Unit {
    constructor(type) {
        this.type = type;
        this.x = 4 * tileSize + 25; this.y = 3 * tileSize + 25;
        this.speed = (type === 'air') ? 4 : (type === 'pierce') ? 1.5 : 2.5;
        this.target = null; this.status = 'Idle';
    }
    update() {
        if (!this.target) return;
        let dx = this.target.x - this.x, dy = this.target.y - this.y, dist = Math.hypot(dx, dy);
        if (dist < 20) {
            this.target.progress += (this.type === 'pierce') ? 2 : 0.5;
            if (this.target.progress >= 100) {
                money += 400; totalEarnings += 400; // Track earnings for Wanted Level
                crimes = crimes.filter(c => c !== this.target);
                this.target = null; this.status = 'Idle';
                playRadio(`Unit ${units.indexOf(this)+1}, subject in custody. Code 4.`); // Code 4: No further assistance needed
            } else { this.status = 'On Scene'; }
        } else {
            let moveX = (dx / dist) * this.speed, moveY = (dy / dist) * this.speed;
            if (this.type === 'air') { this.x += moveX; this.y += moveY; } 
            else {
                if (canMove(this.x + moveX, this.y)) this.x += moveX;
                else if (canMove(this.x, this.y + moveY)) this.y += moveY;
                else { this.x += (Math.random()-0.5)*5; this.y += (Math.random()-0.5)*5; }
            }
            this.status = 'Responding';
        }
    }
    draw() {
        ctx.save(); ctx.translate(this.x, this.y);
        if (this.type === 'air') { ctx.fillStyle = '#f1c40f'; ctx.fillRect(-15, -5, 30, 10); ctx.fillStyle = '#333'; ctx.save(); ctx.rotate(frames * 0.5); ctx.fillRect(-25, -2, 50, 4); ctx.restore(); } 
        else if (this.type === 'pierce') { ctx.fillStyle = 'white'; ctx.fillRect(-25, -12, 50, 24); ctx.fillStyle = '#34495e'; ctx.fillRect(-20, -10, 15, 20); ctx.fillStyle = '#c0392b'; ctx.fillRect(15, -12, 10, 10); } 
        else if (this.type === 'tahoe') { ctx.fillStyle = 'black'; ctx.fillRect(-16, -10, 32, 20); ctx.fillStyle = 'white'; ctx.fillRect(-14, -8, 14, 16); } 
        else if (this.type === 'explorer') { ctx.fillStyle = 'black'; ctx.fillRect(-14, -8, 28, 16); ctx.fillStyle = 'white'; ctx.fillRect(-12, -6, 12, 12); } 
        else { ctx.fillStyle = 'black'; ctx.fillRect(-14, -7, 28, 14); ctx.fillStyle = 'white'; ctx.fillRect(-12, -5, 10, 10); }
        if (this.status !== 'Idle') { ctx.fillStyle = (frames % 10 < 5) ? 'red' : 'blue'; ctx.fillRect(8, -10, 6, 6); }
        ctx.restore();
    }
}

class Suspect {
    constructor() {
        let r, c;
        do { r = Math.floor(Math.random() * rows); c = Math.floor(Math.random() * cols); } while (cityMap[r][c] !== 0);
        this.x = c * tileSize + 25; this.y = r * tileSize + 25;
        this.progress = 0; this.isClaimed = false; this.stunTimer = 0;
        // Adjust speed based on Wanted Level
        this.speed = 1.5 + (wantedLevel * 0.5);
        this.dir = {x: 1, y: 0};
    }
    update() {
        if (this.stunTimer > 0) { this.stunTimer--; return; }
        let nextX = this.x + this.dir.x * this.speed, nextY = this.y + this.dir.y * this.speed;
        if (canMove(nextX, nextY)) { this.x = nextX; this.y = nextY; } 
        else { this.dir = [{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}][Math.floor(Math.random()*4)]; }
        if (Math.random() < 0.01) this.dir = [{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}][Math.floor(Math.random()*4)];
    }
    draw() {
        ctx.fillStyle = this.isClaimed ? '#d35400' : '#c0392b';
        ctx.beginPath(); ctx.arc(this.x, this.y, 12, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = 'white'; ctx.font = '10px Arial'; ctx.fillText("ðŸš¨ LVL "+wantedLevel, this.x-25, this.y-18);
        ctx.fillStyle = "#333"; ctx.fillRect(this.x-15, this.y+15, 30, 5);
        ctx.fillStyle = "#2ecc71"; ctx.fillRect(this.x-15, this.y+15, (this.progress/100)*30, 5);
    }
}

function playRadio(msg) {
    const log = document.getElementById('radio-log');
    const p = document.createElement('p');
    p.className = 'dispatch-msg';
    p.innerText = msg;
    log.prepend(p);
    if(log.childNodes.length > 5) log.removeChild(log.lastChild);
}
function canMove(x, y) {
    let gx = Math.floor(x / tileSize), gy = Math.floor(y / tileSize);
    return (gx >= 0 && gx < cols && gy >= 0 && gy < rows && cityMap[gy][gx] !== 1);
}
function buy(type) {
    let price = {crown: 300, explorer: 500, tahoe: 800, pierce: 2500, air: 1500}[type];
    if (money >= price) { money -= price; units.push(new Unit(type)); }
}
canvas.onclick = (e) => {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left, y = e.clientY - rect.top;
    let car = units.find(u => u.status === 'On Scene' && Math.hypot(u.x - x, u.y - y) < 30);
    if (car && car.target) { car.target.stunTimer = 60; car.target.progress += 25; return; }
    let target = crimes.find(c => !c.isClaimed && Math.hypot(c.x - x, c.y - y) < 40);
    if (target) {
        let unit = units.find(u => u.status === 'Idle');
        if (unit) { target.isClaimed = true; unit.target = target; }
    }
};

function gameLoop() {
    frames++; ctx.clearRect(0, 0, 800, 500);
    // Draw Map
    for(let r=0; r<rows; r++) {
        for(let c=0; c<cols; c++) {
            ctx.fillStyle = (cityMap[r][c] === 1) ? '#2c3e50' : (cityMap[r][c] === 2) ? '#27ae60' : '#7f8c8d';
            ctx.fillRect(c*tileSize, r*tileSize, tileSize, tileSize);
            ctx.strokeStyle = '#333'; ctx.strokeRect(c*tileSize, r*tileSize, tileSize, tileSize);
        }
    }

    // Update Wanted Level based on total earnings (Tier 1 every $5000)
    let newWantedLevel = Math.floor(totalEarnings / 5000) + 1;
    if (newWantedLevel !== wantedLevel) {
        wantedLevel = newWantedLevel;
        playRadio(`Dispatch, threat level elevated. Wanted Level is now ${wantedLevel}!`);
    }

    if (frames % Math.max(200, 600 - wantedLevel * 50) === 0) crimes.push(new Suspect());
    crimes.forEach(c => { c.update(); c.draw(); });
    units.forEach(u => { u.update(); u.draw(); });
    drawMinimap();
    document.getElementById('money').innerText = Math.floor(money);
    document.getElementById('fleet-count').innerText = units.length;
    document.getElementById('wanted-level').innerText = wantedLevel;
    requestAnimationFrame(gameLoop);
}

units.push(new Unit('explorer')); // Start with an Explorer
gameLoop();
</script>
</body>
</html>
