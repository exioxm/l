<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBER DRIFT: OMNI-REBOOT 2025</title>
    <style>
        @import url('fonts.googleapis.com');
        :root { --neon: #0ff; --danger: #f0f; --gold: #ffd700; --glass: rgba(10, 10, 20, 0.95); }
        body { margin: 0; background: #000; overflow: hidden; height: 100vh; display: flex; align-items: center; justify-content: center; font-family: 'Space Grotesk', sans-serif; color: #fff; }
        #core-frame { position: relative; width: 500px; height: 880px; background: #000; border: 2px solid #111; overflow: hidden; box-shadow: 0 0 150px rgba(0, 255, 255, 0.1); }
        canvas { display: block; filter: contrast(1.15) saturate(1.25); cursor: none; }
        
        /* 2025 Hybrid UI: Neo-Brutalist + Glassmorphism */
        .ui-overlay { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; background: var(--glass); backdrop-filter: blur(25px); transition: 0.8s cubic-bezier(0.19, 1, 0.22, 1); }
        .hidden { opacity: 0; pointer-events: none; transform: scale(1.1) rotateX(10deg); }

        .header-brand { font-size: 10px; letter-spacing: 12px; color: rgba(255,255,255,0.2); margin-bottom: 5px; }
        .main-title { font-family: 'Orbitron'; font-size: 60px; font-weight: 900; line-height: 0.9; text-align: center; color: #fff; -webkit-text-stroke: 1.5px var(--neon); filter: drop-shadow(0 0 20px var(--neon)); margin: 0 0 40px 0; }

        .btn-modern { margin: 10px; padding: 22px 60px; background: #fff; color: #000; font-family: 'Orbitron'; font-weight: 900; border: none; cursor: pointer; font-size: 16px; clip-path: polygon(0 0, 100% 0, 90% 100%, 10% 100%); transition: 0.3s; width: 350px; }
        .btn-modern:hover { transform: translateY(-5px); background: var(--neon); box-shadow: 0 0 40px var(--neon); }
        .btn-gold { border: 1px solid var(--gold); color: var(--gold); background: rgba(255, 215, 0, 0.05); }

        /* HUD & Season Pass */
        #hud { position: absolute; top: 30px; left: 30px; right: 30px; display: flex; justify-content: space-between; z-index: 50; pointer-events: none; mix-blend-mode: color-dodge; }
        .hud-item { border-left: 5px solid var(--neon); padding-left: 15px; }
        .hud-label { font-size: 10px; opacity: 0.6; letter-spacing: 3px; }
        .hud-value { font-family: 'Orbitron'; font-size: 28px; }

        #pitstop-ui { position: absolute; top: 10%; width: 80%; padding: 20px; background: var(--glass); border: 1px solid #f0f; display: none; z-index: 150; text-align: center; }
    </style>
</head>
<body>

<div id="core-frame">
    <canvas id="stage"></canvas>

    <!-- Pitstop Mini-game UI -->
    <div id="pitstop-ui">
        <div style="color:#f0f; font-family:'Orbitron';">NEURAL_REPAIR_SEQUENCE</div>
        <p style="font-size:12px;">Sort the corrupted data packets (Touch/Click them!)</p>
        <div id="puzzle-area" style="height:100px; display:flex; justify-content:center; gap:10px;"></div>
    </div>

    <!-- HUD -->
    <div id="hud" class="hidden">
        <div class="hud-item"><div class="hud-label">SYNC_DISTANCE</div><div class="hud-value"><span id="ui-dist">0</span><small>FT</small></div></div>
        <div class="hud-item" style="border-color: #f0f;"><div class="hud-label">NEURAL_CREDITS</div><div class="hud-value">$<span id="ui-cash">0.00</span></div></div>
    </div>

    <!-- Title Screen -->
    <div id="menu-home" class="ui-overlay">
        <div class="header-brand">ZED PRODUCTIONS // 2025</div>
        <h1 class="main-title">CYBER<br>DRIFT</h1>
        <button class="btn-modern" onclick="initNeuralCore(); launchRun();">START_ENGINE</button>
        <button class="btn-modern btn-gold" onclick="alert('Season Pass Coming Soon!')">GOLDEN_PASS</button>
    </div>
</div>

<script>
/** ðŸŽ›ï¸ CORE CONFIG & STATE **/
const canvas = document.getElementById('stage'), ctx = canvas.getContext('2d');
canvas.width = 500; canvas.height = 880;

let state = 'MENU', frame = 0, dist = 0, speed = 12, cash = 0, lastTick = 0;
let px = 225, tx = 225, shake = 0, pitMode = false;
let entities = [], debris = [];
const CAR_W = 50, CAR_H = 100;

/** ðŸ”Š REAL-TIME NEURAL SYNTH **/
let au, osc, masterGain;
function initNeuralCore() {
    if (au) return;
    au = new (window.AudioContext || window.webkitAudioContext)();
    osc = au.createOscillator();
    masterGain = au.createGain();
    osc.type = 'sawtooth';
    osc.frequency.setValueAtTime(40, au.currentTime);
    masterGain.gain.setValueAtTime(0.03, au.currentTime);
    osc.connect(masterGain); masterGain.connect(au.destination);
    osc.start();
}

/** ðŸŽï¸ HYBRID-CASUAL LOGIC **/
function launchRun() {
    state = 'PLAY'; dist = 0; frame = 0; speed = 12; entities = [];
    document.getElementById('menu-home').classList.add('hidden');
    document.getElementById('hud').classList.remove('hidden');
}

window.addEventListener('mousemove', e => {
    const r = canvas.getBoundingClientRect();
    tx = e.clientX - r.left - CAR_W/2;
});

function spawnTraffic() {
    let isRival = (dist > 5000 && Math.random() > 0.8);
    entities.push({
        x: Math.random() * (canvas.width - 100) + 50,
        y: -200,
        c: isRival ? '#f0f' : `hsl(${Math.random()*360}, 60%, 40%)`,
        isRival: isRival,
        v: 0.8 + Math.random() * 0.4
    });
}

function update(time) {
    const dt = (time - lastTick) / 1000;
    lastTick = time;
    if(state !== 'PLAY' || pitMode) return;

    frame++;
    dist += speed * (60 * dt);
    cash += (speed * dt) * 0.05;
    speed += 0.05 * dt;

    // Fluid Neural Steering
    px += (tx - px) * (12 * dt);
    px = Math.max(20, Math.min(canvas.width - CAR_W - 20, px));

    // Adaptive Audio
    if(osc) osc.frequency.setTargetAtTime(40 + (speed * 1.5), au.currentTime, 0.1);

    if(frame % 45 === 0) spawnTraffic();

    // Pit Stop Activation
    if(Math.floor(dist) % 15000 < 50 && dist > 1000) triggerPitStop();

    // AI Physics & Collision
    entities.forEach((car, i) => {
        car.y += (speed * car.v) * (60 * dt);
        
        // Rival AI: Predictive Blocking
        if(car.isRival && car.y < 500) {
            car.x += (px - car.x) * (2 * dt);
        }

        // Accurate AABB Hitbox
        if (Math.abs(px - car.x) < CAR_W * 0.85 && Math.abs(750 - car.y) < CAR_H * 0.85) {
            triggerGameOver();
        }
        if(car.y > canvas.height + 100) entities.splice(i, 1);
    });

    if(shake > 0) shake *= 0.9;
    document.getElementById('ui-dist').innerText = Math.floor(dist);
    document.getElementById('ui-cash').innerText = cash.toFixed(2);
}

function triggerPitStop() {
    pitMode = true;
    const ui = document.getElementById('pitstop-ui');
    const area = document.getElementById('puzzle-area');
    ui.style.display = 'block';
    area.innerHTML = '';
    for(let i=0; i<3; i++) {
        const d = document.createElement('div');
        d.style.cssText = "width:40px; height:40px; background:#f0f; cursor:pointer;";
        d.onclick = () => {
            d.style.opacity = '0.2';
            if([...area.children].every(el => el.style.opacity === '0.2')) {
                pitMode = false;
                ui.style.display = 'none';
                speed += 5;
            }
        };
        area.appendChild(d);
    }
}

function triggerGameOver() {
    state = 'DEAD';
    shake = 25;
    setTimeout(() => location.reload(), 2000);
}

/** ðŸŽ¨ 2.5D WEB-GPU STYLE RENDERER **/
function drawCar(x, y, color, isP) {
    ctx.save();
    ctx.translate(x, y);

    // Dynamic metallic reflection
    const grad = ctx.createLinearGradient(0, 0, CAR_W, 0);
    grad.addColorStop(0, color);
    grad.addColorStop(0.5, '#fff'); // "Ray-traced" highlight
    grad.addColorStop(1, color);

    // Body
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.roundRect(0, 0, CAR_W, CAR_H, 12);
    ctx.fill();

    // Windshield (Translucent)
    ctx.fillStyle = 'rgba(0,0,0,0.8)';
    ctx.roundRect(6, 18, CAR_W-12, 35, 5).fill();

    // Polish highlights
    ctx.fillStyle = 'rgba(255,255,255,0.1)';
    ctx.fillRect(10, 22, 5, 20);

    // Glow-FX
    if(isP) {
        ctx.shadowBlur = 30; ctx.shadowColor = '#0ff';
        ctx.fillStyle = '#fff';
        ctx.fillRect(5, -5, 15, 6); ctx.fillRect(CAR_W-20, -5, 15, 6);
    } else {
        ctx.fillStyle = '#f00';
        ctx.fillRect(5, CAR_H-2, 15, 6); ctx.fillRect(CAR_W-20, CAR_H-2, 15, 6);
    }
    ctx.restore();
}

function draw() {
    ctx.save();
    if(shake > 1) ctx.translate(Math.random()*shake-shake/2, Math.random()*shake-shake/2);

    // Parallax background clear
    ctx.fillStyle = '#020205'; ctx.fillRect(0,0,canvas.width, canvas.height);

    // Procedural Road (Parallax)
    ctx.strokeStyle = '#0a0a1a'; ctx.lineWidth = 2;
    for(let i=0; i<canvas.width; i+=100) {
        ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, canvas.height); ctx.stroke();
    }

    // Motion Lines
    ctx.setLineDash([20, 40]);
    ctx.lineDashOffset = -frame * (speed * 0.5);
    ctx.strokeStyle = '#121225';
    for(let i=100; i<canvas.width; i+=100) {
        ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, canvas.height); ctx.stroke();
    }
    ctx.setLineDash([]);

    if(state === 'PLAY' || state === 'DEAD') {
        entities.forEach(c => drawCar(c.x, c.y, c.c, false));
        if(state !== 'DEAD') drawCar(px, 750, '#fff', true);
    }

    ctx.restore();
    requestAnimationFrame((t) => { update(t); draw(); });
}

draw();
</script>
</body>
</html>
