<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBER-DRIFT: GHOST PROTOCOL</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; display: flex; align-items: center; justify-content: center; height: 100vh; font-family: 'Orbitron', sans-serif; }
        canvas { border: 2px solid #0ff; box-shadow: 0 0 50px rgba(0, 255, 255, 0.2); background: #000; cursor: none; }
        #ui-layer { position: absolute; width: 450px; height: 700px; pointer-events: none; padding: 20px; box-sizing: border-box; color: #0ff; z-index: 10; text-shadow: 0 0 10px #0ff; }
        .menu { position: absolute; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; pointer-events: all; }
        .title { font-size: 35px; color: #f0f; text-shadow: 0 0 20px #f0f; text-align: center; margin-bottom: 20px; line-height: 1.2; }
        .btn { margin: 8px 0; padding: 12px 30px; background: transparent; border: 2px solid #0ff; color: #0ff; font-size: 13px; cursor: pointer; transition: 0.2s; width: 280px; letter-spacing: 1px; }
        .btn:hover { background: #0ff; color: #000; box-shadow: 0 0 20px #0ff; transform: scale(1.05); }
        .admin-trigger { position: absolute; bottom: 15px; right: 15px; font-size: 10px; color: #111; cursor: pointer; }
        #ghost-meter-container { width: 100%; height: 10px; border: 1px solid #0ff; margin-top: 10px; display: none; }
        #ghost-meter { width: 100%; height: 100%; background: #0ff; transition: 0.1s; }
        .hidden { display: none !important; }
        #wanted-stars { color: #f00; font-size: 24px; }
    </style>
    <link href="fonts.googleapis.com" rel="stylesheet">
</head>
<body>
    <div id="ui-layer" class="hidden">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>SCORE: <span id="score">0</span></div>
            <div id="wanted-stars"></div>
        </div>
        <div id="ghost-meter-container">
            <div id="ghost-meter"></div>
        </div>
    </div>

    <div id="main-menu" class="menu">
        <h1 class="title">CYBER-DRIFT<br>SYSTEMS</h1>
        <button class="btn" onclick="setMode('NORMAL')">NORMAL MODE</button>
        <button class="btn" onclick="setMode('WANTED')">WANTED MODE</button>
        <button class="btn" onclick="setMode('CHROMA')">CHROMA BLITZ</button>
        <button class="btn" onclick="setMode('GHOST')" style="border-color: #fff; color: #fff;">GHOST PROTOCOL (NEW)</button>
        <div class="admin-trigger" onclick="setMode('ADMIN')">[ADM_OVERRIDE]</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 450; canvas.height = 700;

        let state = 'MENU', mode = '', score = 0, speed = 8, frame = 0, wantedLvl = 0;
        let ghostStealth = 100, isMoving = false;
        const CAR_W = 40, CAR_H = 75;
        let p1 = { x: 225, targetX: 225, lastX: 225 };
        let obstacles = [], particles = [], collectibles = [];

        window.addEventListener('mousemove', e => {
            const rect = canvas.getBoundingClientRect();
            p1.targetX = e.clientX - rect.left - CAR_W/2;
        });

        function setMode(m) {
            mode = m; state = 'PLAYING'; score = 0; frame = 0; obstacles = []; collectibles = []; ghostStealth = 100;
            if(mode === 'ADMIN') { wantedLvl = 6; speed = 12; }
            else if(mode === 'WANTED') { wantedLvl = 1; speed = 8; }
            else { wantedLvl = 0; speed = 8; }

            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('ui-layer').classList.remove('hidden');
            document.getElementById('ghost-meter-container').style.display = (mode === 'GHOST' ? 'block' : 'none');
            updateStars();
        }

        function updateStars() {
            document.getElementById('wanted-stars').innerText = wantedLvl > 0 ? 'â˜…'.repeat(wantedLvl) : '';
        }

        function update() {
            if(state !== 'PLAYING') return;
            frame++; score++; speed += 0.002;
            
            // Check if player is actively moving for Ghost Mode
            isMoving = Math.abs(p1.x - p1.targetX) > 1;
            p1.x += (p1.targetX - p1.x) * 0.2;

            if(mode === 'GHOST') {
                ghostStealth -= 0.15; // Natural drain
                if(ghostStealth <= 0) die();
                document.getElementById('ghost-meter').style.width = ghostStealth + '%';
                
                if(frame % 40 === 0) { // Spawn Data Orbs
                    collectibles.push({ x: Math.random()*(canvas.width-20)+10, y: -20, size: 8 });
                }
            }

            // Standard Spawning
            if(frame % Math.max(10, 50 - Math.floor(speed)) === 0) {
                let type = 'CIVIL', c = '#333';
                if(wantedLvl >= 6) { type = Math.random() > 0.5 ? 'INTERCEPTOR' : 'SWAT'; c = '#000'; }
                else if(wantedLvl >= 1) { type = Math.random() > 0.5 ? 'POLICE' : 'CIVIL'; c = '#555'; }
                obstacles.push({ x: Math.random()*(canvas.width-60)+30, y: -100, color: c, type });
            }

            // Collectibles logic
            collectibles.forEach((orb, i) => {
                orb.y += speed;
                if(Math.abs(p1.x + CAR_W/2 - orb.x) < 30 && Math.abs(580 - orb.y) < 30) {
                    ghostStealth = Math.min(100, ghostStealth + 20);
                    collectibles.splice(i, 1);
                }
            });

            // Collision logic
            obstacles.forEach((obs, i) => {
                obs.y += speed;
                let hit = Math.abs(p1.x - obs.x) < CAR_W-8 && Math.abs(580 - obs.y) < CAR_H-8;
                
                if(hit) {
                    // In Ghost mode, if you are moving fast, you phase through!
                    if(mode === 'GHOST' && isMoving) {
                        // Phase through success
                    } else {
                        die();
                    }
                }
                if(obs.y > canvas.height) obstacles.splice(i, 1);
            });
            document.getElementById('score').innerText = Math.floor(score/10);
        }

        function die() {
            state = 'MENU';
            document.getElementById('main-menu').classList.remove('hidden');
            document.getElementById('main-menu').innerHTML = `<h1 class="title" style="color:#f00">CONNECTION<br>LOST</h1><button class="btn" onclick="location.reload()">RE-SYNC</button>`;
        }

        function draw() {
            ctx.fillStyle = '#050510'; ctx.fillRect(0,0,canvas.width, canvas.height);
            
            // Grid
            ctx.strokeStyle = '#112244';
            for(let i=0; i<canvas.width; i+=50) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); ctx.stroke(); }

            if(state === 'PLAYING') {
                obstacles.forEach(o => {
                    ctx.fillStyle = o.color; ctx.shadowBlur = 10; ctx.shadowColor = o.color;
                    ctx.fillRect(o.x, o.y, CAR_W, CAR_H);
                });

                collectibles.forEach(orb => {
                    ctx.fillStyle = '#0ff'; ctx.shadowBlur = 20; ctx.shadowColor = '#0ff';
                    ctx.beginPath(); ctx.arc(orb.x, orb.y, orb.size, 0, Math.PI*2); ctx.fill();
                });

                // Draw Player
                ctx.save();
                if(mode === 'GHOST') {
                    ctx.globalAlpha = isMoving ? 0.3 : 1.0;
                    ctx.shadowColor = isMoving ? '#fff' : '#0ff';
                } else {
                    ctx.shadowColor = '#0ff';
                }
                ctx.shadowBlur = 20;
                ctx.fillStyle = (mode === 'GHOST' && !isMoving) ? '#f0f' : '#0ff';
                ctx.fillRect(p1.x, 580, CAR_W, CAR_H);
                ctx.restore();
            }
        }

        function loop() { update(); draw(); requestAnimationFrame(loop); }
        loop();
    </script>
</body>
</html>
