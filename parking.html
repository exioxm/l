<!DOCTYPE html>
<html>
<head>
    <title>Parking Mania | ZED Productions</title>
    <style>
        :root { --gold: #f1c40f; --accent: #3498db; --bg: #0f172a; --card: #1e293b; --locked: #475569; }
        body { margin: 0; background: var(--bg); display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'Segoe UI', sans-serif; color: white; overflow: hidden; }
        
        /* Menu System */
        .screen { text-align: center; background: var(--card); padding: 50px; border-radius: 24px; border: 1px solid #334155; width: 700px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); position: absolute; transition: 0.4s; z-index: 100; }
        .hidden { opacity: 0; pointer-events: none; transform: scale(0.9); }
        
        h1 { font-size: 60px; margin: 0; color: var(--gold); text-transform: uppercase; letter-spacing: 5px; font-weight: 900; }
        .brand { font-size: 18px; color: var(--accent); margin-bottom: 40px; letter-spacing: 2px; font-weight: bold; opacity: 0.8; }
        
        .main-btn { background: var(--gold); color: #000; border: none; padding: 18px 60px; font-size: 22px; font-weight: bold; border-radius: 50px; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 15px rgba(241, 196, 15, 0.3); }
        .main-btn:hover { transform: scale(1.1); background: #fff; }

        /* Level Selector */
        .level-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-top: 20px; }
        .level-btn { background: #334155; border: 2px solid #475569; color: white; padding: 15px; border-radius: 12px; cursor: pointer; transition: 0.2s; position: relative; }
        .level-btn:hover:not(.locked) { border-color: var(--gold); background: #475569; transform: translateY(-3px); }
        .level-btn.locked { background: var(--locked); opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }
        .level-btn .stars { color: var(--gold); display: block; font-size: 12px; margin-top: 5px; }
        .lock-icon { font-size: 10px; display: block; color: #94a3b8; }

        /* HUD */
        canvas { background: #1e293b; border: 6px solid #334155; border-radius: 16px; display: none; }
        #hud { position: absolute; top: 20px; width: 100%; text-align: center; display: none; pointer-events: none; }
        .star-box { font-size: 45px; background: rgba(15, 23, 42, 0.9); padding: 10px 40px; border-radius: 100px; border: 2px solid #475569; display: inline-block; }
        .s-off { color: #334155; text-shadow: none; }
        .s-on { color: var(--gold); text-shadow: 0 0 15px var(--gold); }
        #tutorial-box { position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); padding: 20px 40px; border-radius: 15px; border-bottom: 4px solid var(--accent); font-size: 20px; text-align: center; display: none; max-width: 80%; }
    </style>
</head>
<body>

    <div id="home-screen" class="screen">
        <h1>PARKING MANIA</h1>
        <div class="brand">By: ZED Productions</div>
        <button class="main-btn" onclick="showLevels()">LEVELS</button>
    </div>

    <div id="level-screen" class="screen hidden">
        <button onclick="showHome()" style="background:none; border:none; color:var(--accent); cursor:pointer; font-weight:bold; margin-bottom:20px;">← BACK TO MENU</button>
        <h2 style="margin:0">SELECT LEVEL</h2>
        <div class="level-grid" id="level-selector"></div>
    </div>

    <div id="hud">
        <div class="star-box">
            <span id="s1" class="s-on">★</span>
            <span id="s2" class="s-on">★</span>
            <span id="s3" class="s-on">★</span>
        </div>
        <div id="tutorial-box"></div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = 1000; canvas.height = 700;

    let gameActive = false;
    let currentLvlIdx = 0;
    const car = { x:0, y:0, angle:0, speed:0, accel:0.18, friction:0.96, turnSpeed:0.045, w:45, h:24, hits:0 };
    const trailer = { x:0, y:0, angle:0, w:65, h:26 };
    const keys = {};

    // 20 Progressive Levels
    const levels = [];
    for(let i=0; i<20; i++) {
        let walls = [
            {x:0, y:0, w:1000, h:15}, {x:0, y:685, w:1000, h:15},
            {x:0, y:0, w:15, h:700}, {x:985, y:0, w:15, h:700}
        ];
        
        // Procedural complexity
        if(i > 0) walls.push({x: 300, y: 0, w: 30, h: 400});
        if(i > 5) walls.push({x: 600, y: 300, w: 30, h: 400});
        if(i > 10) walls.push({x: 100, y: 200, w: 400, h: 30});

        levels.push({
            useTrailer: i > 0 && i % 2 !== 0,
            start: {x: 80, y: 80, a: 0},
            target: {x: 850 - (i*5), y: 580 - (i*5), w: 80, h: 50},
            walls: walls,
            hint: i === 0 ? "TUTORIAL: Use WASD to steer the Red Car into the Yellow Box. Don't hit the walls!" : ""
        });
    }

    function showLevels() {
        document.getElementById("home-screen").classList.add("hidden");
        document.getElementById("level-screen").classList.remove("hidden");
        initLevelButtons();
    }

    function showHome() {
        document.getElementById("home-screen").classList.remove("hidden");
        document.getElementById("level-screen").classList.add("hidden");
    }

    function initLevelButtons() {
        const grid = document.getElementById("level-selector");
        grid.innerHTML = "";
        levels.forEach((l, i) => {
            const stars = parseInt(localStorage.getItem(`zed_stars_lvl${i}`)) || 0;
            const prevStars = i === 0 ? 3 : (parseInt(localStorage.getItem(`zed_stars_lvl${i-1}`)) || 0);
            const isLocked = i !== 0 && prevStars === 0;

            const btn = document.createElement("div");
            btn.className = `level-btn ${isLocked ? 'locked' : ''}`;
            btn.innerHTML = `
                <b>${i === 0 ? "TUTORIAL" : i+1}</b>
                <span class="stars">${isLocked ? '<span class="lock-icon">LOCKED</span>' : "★".repeat(stars) + "☆".repeat(3-stars)}</span>
            `;
            if(!isLocked) btn.onclick = () => startLevel(i);
            grid.appendChild(btn);
        });
    }

    function startLevel(idx) {
        currentLvlIdx = idx;
        const l = levels[idx];
        document.getElementById("level-screen").style.display = "none";
        canvas.style.display = "block";
        hud.style.display = "block";
        
        car.x = l.start.x; car.y = l.start.y; car.angle = l.start.a;
        car.speed = 0; car.hits = 0;
        trailer.x = car.x - 70; trailer.y = car.y; trailer.angle = car.angle;

        const tut = document.getElementById("tutorial-box");
        tut.style.display = l.hint ? "block" : "none";
        tut.innerText = l.hint;

        updateStars();
        gameActive = true;
        requestAnimationFrame(loop);
    }

    function updateStars() {
        document.getElementById("s3").className = car.hits < 1 ? "s-on" : "s-off";
        document.getElementById("s2").className = car.hits < 2 ? "s-on" : "s-off";
        document.getElementById("s1").className = car.hits < 3 ? "s-on" : "s-off";
        if(car.hits >= 3) {
            gameActive = false;
            alert("CRASHED! Level Failed.");
            location.reload();
        }
    }

    window.addEventListener("keydown", e => {
        keys[e.code] = true;
        if(e.code === "Escape") location.reload();
    });
    window.addEventListener("keyup", e => keys[e.code] = false);

    function drawVehicle(obj, color, isTrailer) {
        ctx.save();
        ctx.translate(obj.x, obj.y);
        ctx.rotate(obj.angle);
        
        // Body Shadow
        ctx.fillStyle = "rgba(0,0,0,0.3)";
        ctx.fillRect(-obj.w/2 + 4, -obj.h/2 + 4, obj.w, obj.h);

        // Main Body
        ctx.fillStyle = color;
        ctx.fillRect(-obj.w/2, -obj.h/2, obj.w, obj.h);

        // Windows
        ctx.fillStyle = "#222";
        if(!isTrailer) {
            ctx.fillRect(obj.w/6, -obj.h/2 + 3, obj.w/4, obj.h - 6); // Windshield
        } else {
            ctx.fillStyle = "#334155"; // Cargo detail
            ctx.fillRect(-obj.w/2 + 5, -obj.h/2 + 5, obj.w - 10, obj.h - 10);
        }

        // Lights
        if(!isTrailer) {
            ctx.fillStyle = "white"; // Front
            ctx.fillRect(obj.w/2-4, -obj.h/2+2, 5, 6);
            ctx.fillRect(obj.w/2-4, obj.h/2-8, 5, 6);
            ctx.fillStyle = "red"; // Back
            ctx.fillRect(-obj.w/2-1, -obj.h/2+2, 3, 6);
            ctx.fillRect(-obj.w/2-1, obj.h/2-8, 3, 6);
        }

        ctx.restore();
    }

    function loop() {
        if(!gameActive) return;
        const l = levels[currentLvlIdx];

        // Movement
        if(keys["KeyW"]) car.speed += car.accel;
        if(keys["KeyS"]) car.speed -= car.accel;
        if(Math.abs(car.speed) > 0.1) {
            const turnDir = car.speed > 0 ? 1 : -1;
            if(keys["KeyA"]) car.angle -= car.turnSpeed * turnDir;
            if(keys["KeyD"]) car.angle += car.turnSpeed * turnDir;
        }
        car.speed *= car.friction;
        car.x += Math.cos(car.angle) * car.speed;
        car.y += Math.sin(car.angle) * car.speed;

        // Trailer Pivot Logic
        if(l.useTrailer) {
            const tx = car.x - Math.cos(car.angle) * 25;
            const ty = car.y - Math.sin(car.angle) * 25;
            const dx = tx - trailer.x;
            const dy = ty - trailer.y;
            trailer.angle = Math.atan2(dy, dx);
            const dist = Math.sqrt(dx*dx + dy*dy);
            const moveDist = dist - 40;
            trailer.x += Math.cos(trailer.angle) * moveDist;
            trailer.y += Math.sin(trailer.angle) * moveDist;
        }

        // Collision Check
        l.walls.forEach(w => {
            const check = (obj) => (obj.x > w.x && obj.x < w.x+w.w && obj.y > w.y && obj.y < w.y+w.h);
            if(check(car) || (l.useTrailer && check(trailer))) {
                car.speed *= -1.5;
                car.hits++;
                updateStars();
            }
        });

        // Win Condition
        const t = l.target;
        const goal = l.useTrailer ? trailer : car;
        if(goal.x > t.x && goal.x < t.x+t.w && goal.y > t.y && goal.y < t.y+t.h && Math.abs(car.speed) < 0.1) {
            const score = 3 - car.hits;
            localStorage.setItem(`zed_stars_lvl${currentLvlIdx}`, Math.max(score, (localStorage.getItem(`zed_stars_lvl${currentLvlIdx}`) || 0)));
            alert(`Level Clear! Stars: ${score}`);
            location.reload();
        }

        // Draw Everything
        ctx.clearRect(0,0,canvas.width,canvas.height);
        
        // Target Box
        ctx.setLineDash([10, 5]);
        ctx.strokeStyle = var(--gold); ctx.lineWidth = 4;
        ctx.strokeRect(t.x, t.y, t.w, t.h);
        ctx.setLineDash([]);

        // Walls
        ctx.fillStyle = "#475569";
        l.walls.forEach(w => ctx.fillRect(w.x, w.y, w.w, w.h));

        if(l.useTrailer) drawVehicle(trailer, "#64748b", true);
        drawVehicle(car, "#ef4444", false);

        requestAnimationFrame(loop);
    }

    initLevelButtons();
</script>
</body>
</html>
