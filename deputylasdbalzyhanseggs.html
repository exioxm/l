<!DOCTYPE html>
<html>
<head>
    <title>LASD: DTLA Command v10</title>
    <style>
        body { background: #000; color: white; font-family: 'Segoe UI', sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        #game-container { position: relative; display: flex; border: 5px solid #333; }
        canvas { background: #111; cursor: crosshair; }
        .ui-top { position: absolute; top: -50px; width: 800px; display: flex; justify-content: space-between; font-size: 22px; font-weight: bold; color: #f1c40f; text-shadow: 2px 2px #000; }
        #side-panel { width: 250px; background: #222; padding: 20px; border-left: 4px solid #f1c40f; }
        .unit-card { background: #333; padding: 10px; margin-bottom: 8px; border-radius: 5px; border-left: 5px solid #f1c40f; cursor: pointer; font-size: 13px; }
        .btn-dispatch { background: #d35400; border: none; color: white; padding: 12px; width: 100%; border-radius: 5px; cursor: pointer; margin-top: 10px; font-weight: bold; transition: 0.2s; }
        .btn-dispatch:hover { background: #e67e22; }
        #radio-log { position: absolute; bottom: 20px; left: 20px; width: 280px; height: 80px; background: rgba(0,0,0,0.8); border-radius: 5px; padding: 10px; font-size: 11px; color: #2ecc71; border: 1px solid #333; pointer-events: none; overflow: hidden; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="ui-top">
        <span>ðŸ’° $<span id="money">1000</span></span>
        <span>ðŸš” Fleet: <span id="fleet-count">1</span></span>
    </div>

    <canvas id="cityCanvas" width="800" height="500"></canvas>

    <div id="side-panel">
        <h3 style="margin-top:0; color:#f1c40f;">DTLA PRECINCT</h3>
        <div class="unit-card" onclick="buy('crown')">Crown Victoria ($300)</div>
        <div class="unit-card" onclick="buy('explorer')">Explorer Utility ($500)</div>
        <div class="unit-card" onclick="buy('tahoe')">Tahoe Interceptor ($800)</div>
        <div class="unit-card" onclick="buy('air')">Aero Bureau Heli ($1500)</div>
        
        <button class="btn-dispatch" onclick="dispatchAll()">DISPATCH ALL UNITS</button>

        <p style="font-size:11px; color:#bdc3c7; margin-top:15px;">
            1. Click ðŸš¨ to select crime.<br>
            2. "Dispatch All" to send backup.<br>
            3. 2026 Fleet standards applied.
        </p>
    </div>
    
    <div id="radio-log"></div>
</div>

<script>
const canvas = document.getElementById('cityCanvas');
const ctx = canvas.getContext('2d');
const tileSize = 50;
const cols = 16, rows = 10;

// Urban DTLA Map: 0=Road, 1=Skyscraper, 2=LASD HQ
const cityMap = [
    [1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [1,1,0,1,1,0,2,2,0,1,1,0,1,1,1,1],
    [1,1,0,1,1,0,2,2,0,1,1,0,1,1,1,1],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1]
];

let money = 1000, units = [], criminals = [], frames = 0;
let selectedCrime = null;

class Unit {
    constructor(type) {
        this.type = type;
        this.x = 7 * tileSize; this.y = 2 * tileSize; // Start at HQ
        this.angle = 0; this.speed = 0;
        this.maxSpeed = (type === 'air') ? 5 : 3.5;
        this.target = null;
    }
    update() {
        if (this.target) {
            let dx = this.target.x - this.x, dy = this.target.y - this.y, dist = Math.hypot(dx, dy);
            if (dist < 30) {
                this.speed *= 0.8;
                this.target.progress += 0.4;
                if (this.target.progress >= 100) {
                    money += 500; criminals = criminals.filter(c => c !== this.target);
                    units.forEach(u => { if(u.target === this.target) u.target = null; });
                    playRadio("10-98: Responding units, suspect 10-15 (In custody).");
                }
            } else { this.angle = Math.atan2(dy, dx); this.speed += 0.15; }
        }
        this.speed *= 0.96;
        let vx = Math.cos(this.angle) * this.speed, vy = Math.sin(this.angle) * this.speed;
        if (this.type === 'air' || canPass(this.x + vx, this.y + vy)) { this.x += vx; this.y += vy; } else { this.speed = 0; }
    }
    draw() {
        ctx.save(); ctx.translate(this.x, this.y); ctx.rotate(this.angle);
        ctx.fillStyle = this.type === 'air' ? '#f1c40f' : '#000';
        ctx.fillRect(-12, -7, 24, 14);
        ctx.fillStyle = '#fff'; ctx.fillRect(-8, -5, 8, 10);
        if (this.target) { ctx.fillStyle = (frames % 10 < 5) ? 'red' : 'blue'; ctx.fillRect(8, -5, 5, 5); }
        ctx.restore();
    }
}

class Suspect {
    constructor() {
        let r, c;
        // Search for a road tile (0) to spawn in
        do { r = Math.floor(Math.random() * rows); c = Math.floor(Math.random() * cols); } while (cityMap[r][c] !== 0);
        this.x = c * tileSize + 25; this.y = r * tileSize + 25;
        this.progress = 0; this.assigned = false; this.speed = 1.2;
        this.dir = Math.random() * Math.PI * 2;
    }
    update() {
        if (frames % 100 === 0) this.dir += (Math.random() - 0.5);
        let vx = Math.cos(this.dir) * this.speed, vy = Math.sin(this.dir) * this.speed;
        if (canPass(this.x + vx, this.y + vy)) { this.x += vx; this.y += vy; } else { this.dir += Math.PI; }
    }
    draw() {
        if (selectedCrime === this) { ctx.strokeStyle = '#f1c40f'; ctx.lineWidth = 3; ctx.beginPath(); ctx.arc(this.x, this.y, 25, 0, Math.PI*2); ctx.stroke(); }
        ctx.fillStyle = '#c0392b'; ctx.beginPath(); ctx.arc(this.x, this.y, 10, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = '#fff'; ctx.fillRect(this.x-10, this.y+15, 20, 5);
        ctx.fillStyle = '#2ecc71'; ctx.fillRect(this.x-10, this.y+15, (this.progress/100)*20, 5);
    }
}

function canPass(x, y) {
    let gx = Math.floor(x / tileSize), gy = Math.floor(y / tileSize);
    return cityMap[gy] && cityMap[gy][gx] !== 1;
}

canvas.onclick = (e) => {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left, y = e.clientY - rect.top;
    selectedCrime = criminals.find(c => Math.hypot(c.x - x, c.y - y) < 30) || null;
    if (selectedCrime) playRadio("Dispatch: 211 in progress, units select for assignment.");
};

function dispatchAll() {
    if (!selectedCrime) return playRadio("Error: No active crime selected.");
    let count = 0;
    units.forEach(u => { if (!u.target) { u.target = selectedCrime; count++; } });
    playRadio(`Attention all units: 10-34 (Riot/Backup) requested. ${count} units enroute.`);
}

function buy(type) {
    let p = {crown:300, explorer:500, tahoe:800, air:1500}[type];
    if (money >= p) { money -= p; units.push(new Unit(type)); document.getElementById('fleet-count').innerText = units.length; }
}

function playRadio(m) {
    let log = document.getElementById('radio-log');
    log.innerHTML = `<div style="padding:2px 0;">[RADIO] ${m}</div>` + log.innerHTML;
}

function gameLoop() {
    frames++; ctx.clearRect(0, 0, 800, 500);
    for(let r=0; r<rows; r++) {
        for(let c=0; c<cols; c++) {
            ctx.fillStyle = cityMap[r][c] === 1 ? '#1a1a1a' : (cityMap[r][c] === 2 ? '#2c3e50' : '#333');
            ctx.fillRect(c*tileSize, r*tileSize, tileSize, tileSize);
            ctx.strokeStyle = '#222'; ctx.strokeRect(c*tileSize, r*tileSize, tileSize, tileSize);
        }
    }
    if (frames % 600 === 0) { criminals.push(new Suspect()); playRadio("Dispatch: Attention all units, we have a 459 in progress."); }
    criminals.forEach(c => { c.update(); c.draw(); });
    units.forEach(u => { u.update(); u.draw(); });
    document.getElementById('money').innerText = Math.floor(money);
    requestAnimationFrame(gameLoop);
}

units.push(new Unit('explorer'));
gameLoop();
</script>
</body>
</html>
