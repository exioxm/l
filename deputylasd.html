<!DOCTYPE html>
<html>
<head>
    <title>LASD Patrol Command</title>
    <style>
        body { background: #111; color: white; font-family: 'Segoe UI', sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        #game-container { position: relative; }
        canvas { background: #222; border: 4px solid #f1c40f; border-radius: 8px; cursor: crosshair; }
        .ui { position: absolute; top: -50px; width: 100%; display: flex; justify-content: space-between; font-size: 20px; font-weight: bold; color: #f1c40f; }
        #dispatch-panel { position: absolute; right: -250px; top: 0; width: 220px; background: #2c3e50; padding: 15px; border-radius: 10px; border: 2px solid #f1c40f; }
        .btn { background: #f1c40f; border: none; color: #111; padding: 10px; width: 100%; border-radius: 5px; cursor: pointer; margin-top: 10px; font-weight: bold; }
        .btn:disabled { background: #7f8c8d; cursor: not-allowed; }
        #status-feed { font-size: 12px; color: #bdc3c7; margin-top: 10px; height: 100px; overflow-y: hidden; border-top: 1px solid #444; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="ui">
        <span>ðŸ’° Budget: $<span id="money">500</span></span>
        <span>ðŸš” Fleet: <span id="fleet-count">1</span> Units</span>
    </div>

    <canvas id="mapCanvas" width="800" height="500"></canvas>

    <div id="dispatch-panel">
        <h3>STATION SHOP</h3>
        <button class="btn" onclick="buyUnit('patrol')">Add Patrol Car ($200)</button>
        <button class="btn" onclick="buyUnit('k9')">Add K9 Unit ($500)</button>
        <button class="btn" onclick="buyUnit('air')">Add Aero Bureau ($1500)</button>
        
        <div id="status-feed">
            <p>> Station Online...</p>
            <p>> Waiting for calls...</p>
        </div>
    </div>
</div>

<script>
const canvas = document.getElementById('mapCanvas');
const ctx = canvas.getContext('2d');

let money = 500;
let units = [];
let crimes = [];
let frames = 0;

class PatrolUnit {
    constructor(type) {
        this.type = type;
        this.x = 400; this.y = 250; // Start at Station (Center)
        this.speed = type === 'air' ? 4 : (type === 'k9' ? 2.5 : 2);
        this.target = null;
        this.status = 'Idle';
        this.color = type === 'air' ? '#f1c40f' : 'white';
    }
    update() {
        if (this.target) {
            let dx = this.target.x - this.x;
            let dy = this.target.y - this.y;
            let dist = Math.hypot(dx, dy);
            
            if (dist < 5) {
                // At crime scene
                this.target.progress += 1;
                if (this.target.progress > 100) {
                    money += this.target.value;
                    logStatus(`Unit resolved ${this.target.name}. +$${this.target.value}`);
                    crimes = crimes.filter(c => c !== this.target);
                    this.target = null;
                    this.status = 'Idle';
                } else {
                    this.status = 'On Scene';
                }
            } else {
                this.x += (dx / dist) * this.speed;
                this.y += (dy / dist) * this.speed;
                this.status = 'Responding';
            }
        }
    }
    draw() {
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x - 5, this.y - 5, 10, 10); // Car
        ctx.font = "10px Arial";
        ctx.fillText(this.status, this.x - 15, this.y + 20);
    }
}

class CrimeCall {
    constructor() {
        this.x = Math.random() * (canvas.width - 40);
        this.y = Math.random() * (canvas.height - 40);
        this.progress = 0;
        this.name = ["459 Burglary", "211 Robbery", "GTA", "Trespass"][Math.floor(Math.random() * 4)];
        this.value = Math.floor(Math.random() * 50) + 50;
    }
    draw() {
        ctx.fillStyle = '#e74c3c';
        ctx.beginPath(); ctx.arc(this.x, this.y, 15, 0, Math.PI * 2); ctx.fill();
        ctx.fillStyle = "white"; ctx.font = "12px Arial";
        ctx.fillText("ðŸš¨ " + this.name, this.x - 20, this.y - 20);
        // Progress Bar
        ctx.fillStyle = "#444"; ctx.fillRect(this.x - 15, this.y + 20, 30, 4);
        ctx.fillStyle = "#2ecc71"; ctx.fillRect(this.x - 15, this.y + 20, (this.progress / 100) * 30, 4);
    }
}

// Logic: Dispatch nearest available car on click
canvas.onclick = (e) => {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left, y = e.clientY - rect.top;
    
    let clickedCrime = crimes.find(c => Math.hypot(c.x - x, c.y - y) < 30);
    if (clickedCrime) {
        let availableUnit = units.find(u => u.status === 'Idle');
        if (availableUnit) {
            availableUnit.target = clickedCrime;
            logStatus(`Dispatching unit to ${clickedCrime.name}`);
        } else {
            logStatus("No units available!");
        }
    }
};

function buyUnit(type) {
    let cost = {patrol: 200, k9: 500, air: 1500}[type];
    if (money >= cost) {
        money -= cost;
        units.push(new PatrolUnit(type));
        logStatus(`Purchased ${type.toUpperCase()} unit.`);
    }
}

function logStatus(msg) {
    const feed = document.getElementById('status-feed');
    feed.innerHTML = `<p>> ${msg}</p>` + feed.innerHTML;
}

function startGame() {
    units.push(new PatrolUnit('patrol'));
    gameLoop();
}

function gameLoop() {
    frames++;
    ctx.clearRect(0, 0, 800, 500);
    
    // Draw Station
    ctx.fillStyle = '#34495e'; ctx.fillRect(380, 230, 40, 40);
    ctx.fillStyle = 'white'; ctx.fillText("LASD STATION", 365, 220);

    if (frames % 200 === 0) crimes.push(new CrimeCall());

    units.forEach(u => { u.update(); u.draw(); });
    crimes.forEach(c => c.draw());

    document.getElementById('money').innerText = money;
    document.getElementById('fleet-count').innerText = units.length;

    requestAnimationFrame(gameLoop);
}

startGame();
</script>
</body>
</html>
