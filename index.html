<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nitro Racer: Cyber Pursuit v1.2</title>
    <style>
        body { margin: 0; background: #010103; overflow: hidden; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #game-container { position: relative; width: 440px; height: 750px; background: #050508; border: 2px solid #00f2ff; box-shadow: 0 0 30px rgba(0, 242, 255, 0.2); }
        canvas { display: block; width: 100%; height: 100%; }
        
        #ui, .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff; z-index: 10; }
        #ui { justify-content: flex-start; padding-top: 20px; visibility: hidden; }
        .overlay { pointer-events: auto; background: rgba(5, 5, 10, 0.95); backdrop-filter: blur(10px); transition: 0.3s; }
        .hidden { display: none !important; }
        
        .stat-row { width: 90%; display: flex; justify-content: space-between; background: rgba(0, 242, 255, 0.1); padding: 10px; border-radius: 5px; border-bottom: 2px solid #00f2ff; box-sizing: border-box; }
        .label { font-size: 9px; color: #00f2ff; text-transform: uppercase; letter-spacing: 1px; }
        .val { font-size: 20px; font-weight: 900; text-shadow: 0 0 8px #00f2ff; font-family: monospace; }
        
        h1 { color: #00f2ff; font-size: 32px; font-style: italic; text-shadow: 0 0 15px #00f2ff; margin-bottom: 5px; text-transform: uppercase; }
        .btn { width: 220px; padding: 12px; margin: 6px; background: transparent; border: 1px solid #00f2ff; color: #00f2ff; font-weight: bold; cursor: pointer; transition: 0.2s; text-transform: uppercase; border-radius: 4px; }
        .btn:hover { background: #00f2ff; color: #000; box-shadow: 0 0 20px #00f2ff; transform: translateY(-2px); }
        
        .garage-container { width: 100%; overflow-x: auto; display: flex; padding: 20px 0; scroll-snap-type: x mandatory; }
        .car-card { flex: 0 0 160px; height: 200px; margin: 0 15px; background: rgba(255,255,255,0.05); border: 1px solid #222; scroll-snap-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 8px; transition: 0.3s; cursor: pointer; }
        .car-card.selected { border-color: #00f2ff; background: rgba(0, 242, 255, 0.15); box-shadow: 0 0 15px #00f2ff; transform: scale(1.05); }
        .price { color: #ffcc00; font-weight: bold; margin-top: 5px; font-size: 14px; }

        #wanted span { font-size: 24px; color: #333; margin: 0 3px; }
        #wanted span.active { color: #ff0044; text-shadow: 0 0 10px #ff0044; }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
    <div id="ui">
        <div class="stat-row">
            <div><div class="label">Distance</div><div class="val" id="score">0</div></div>
            <div><div class="label">Speed</div><div class="val" id="speedDisp">0</div></div>
            <div><div class="label">Credits</div><div class="val" id="creditsUI">0</div></div>
        </div>
        <div id="wanted" style="margin-top:15px;"><span id="s1">★</span><span id="s2">★</span><span id="s3">★</span><span id="s4">★</span><span id="s5">★</span></div>
    </div>

    <div id="menu" class="overlay">
        <h1>NITRO RACER</h1>
        <div style="color:#ffcc00; margin-bottom:15px; font-family: monospace;">$ <span id="crMenu">0</span></div>
        <button class="btn" onclick="startGame('NORMAL')">Arcade Drive</button>
        <button class="btn" style="border-color:#ff0044; color:#ff0044;" onclick="openPanel('pursuit-menu')">High Pursuit</button>
        <button class="btn" style="border-color:#00ff88; color:#00ff88;" onclick="openPanel('garage')">Garage</button>
        <button class="btn" style="border-color:#555; color:#777; font-size:10px; margin-top:15px;" onclick="toggleDebug()">[ DEBUG INFO ]</button>
    </div>

    <div id="pursuit-menu" class="overlay hidden">
        <h1 style="color:#ff0044;">WANTED</h1>
        <button class="btn" onclick="startGame('PURSUIT')">Start Escape</button>
        <button class="btn" onclick="openPanel('menu')">Back</button>
    </div>

    <div id="garage" class="overlay hidden">
        <h1>VEHICLES</h1>
        <div class="garage-container" id="carGrid"></div>
        <button class="btn" style="margin-top:15px;" onclick="openPanel('menu')">Confirm</button>
    </div>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = 440; canvas.height = 750;

    // Game Config & Particles
    const VERSION = "v1.2";
    let showDebug = false, shake = 0, particles = [];
    let credits = parseInt(localStorage.getItem('nitroCr')) || 1000;
    let unlockedCars = JSON.parse(localStorage.getItem('nitroCars')) || ['Specter'];
    let currentCar = localStorage.getItem('nitroActiveCar') || 'Specter';

    const carData = {
        'Specter': { w: 42, h: 84, price: 0, speed: 8, color: '#00f2ff' },
        'Interceptor': { w: 38, h: 90, price: 5000, speed: 11, color: '#ff0044' },
        'Goliath': { w: 54, h: 82, price: 12000, speed: 6, color: '#00ff88' },
        'Venom': { w: 40, h: 92, price: 25000, speed: 14, color: '#ffcc00' }
    };

    let gameState = 'MENU', gameMode = 'NORMAL', score = 0, speed = 0, frames = 0, enemies = [], keys = {};
    let p1 = { x: 150, y: 600, alive: true };

    window.addEventListener("keydown", (e) => keys[e.code] = true);
    window.addEventListener("keyup", (e) => keys[e.code] = false);

    function toggleDebug() { showDebug = !showDebug; }
    function openPanel(id) {
        document.querySelectorAll('.overlay').forEach(p => p.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        if(id === 'garage') renderGarage();
        updateCurrencyUI();
    }

    function updateCurrencyUI() {
        document.getElementById('crMenu').innerText = credits.toLocaleString();
        document.getElementById('creditsUI').innerText = credits.toLocaleString();
    }

    function renderGarage() {
        const grid = document.getElementById('carGrid'); grid.innerHTML = '';
        for(let name in carData) {
            const data = carData[name];
            const isOwned = unlockedCars.includes(name);
            const card = document.createElement('div');
            card.className = `car-card ${currentCar === name ? 'selected' : ''}`;
            card.innerHTML = `<h3>${name}</h3><p>TOP SPEED: ${data.speed * 15} MPH</p><div class="price">${isOwned ? 'OWNED' : '$'+data.price}</div>`;
            card.onclick = () => {
                if(isOwned) currentCar = name;
                else if(credits >= data.price) {
                    credits -= data.price; unlockedCars.push(name); currentCar = name;
                }
                localStorage.setItem('nitroCr', credits);
                localStorage.setItem('nitroCars', JSON.stringify(unlockedCars));
                localStorage.setItem('nitroActiveCar', currentCar);
                renderGarage();
            };
            grid.appendChild(card);
        }
    }

    function drawCar(ctx, x, y, name, color, isEnemy = false) {
        const d = carData[name] || { w: 40, h: 80 };
        ctx.save();
        ctx.translate(x, y);
        // Underglow & Shadow
        ctx.shadowBlur = 10; ctx.shadowColor = color;
        ctx.fillStyle = "#111"; ctx.fillRect(0, 0, d.w, d.h);
        ctx.shadowBlur = 0;
        // Details
        ctx.strokeStyle = color; ctx.lineWidth = 2; ctx.strokeRect(0, 0, d.w, d.h);
        ctx.fillStyle = "rgba(255,255,255,0.2)"; ctx.fillRect(d.w*0.2, d.h*0.3, d.w*0.6, d.h*0.2); // Windshield
        ctx.fillStyle = color; ctx.fillRect(-2, d.h - 5, d.w + 4, 3); // Wing
        ctx.restore();
    }

    function startGame(mode) {
        gameState = 'PLAY'; gameMode = mode;
        score = 0; speed = carData[currentCar].speed; enemies = []; frames = 0; shake = 0;
        p1 = { x: 150, y: 600, alive: true };
        document.querySelectorAll('.overlay').forEach(p => p.classList.add('hidden'));
        document.getElementById('ui').style.visibility = 'visible';
        gameLoop();
    }

    function spawnEnemy() {
        const lane = Math.floor(Math.random() * 4);
        const isPolice = (gameMode === 'PURSUIT' && Math.random() > 0.4);
        enemies.push({ x: 60 + (lane * 85), y: -100, w: 40, h: 80, v: 2 + Math.random() * 3, type: isPolice ? 'POLICE' : 'CIV', color: isPolice ? '#ff0044' : '#444' });
    }

    function gameLoop() {
        if(gameState !== 'PLAY') return;
        frames++; score++; speed += 0.0015;
        const d = carData[currentCar];

        // Handling
        if(keys['ArrowLeft'] && p1.x > 50) p1.x -= 7.5;
        if(keys['ArrowRight'] && p1.x < 390 - d.w) p1.x += 7.5;

        // Exhaust Particles
        if(frames % 2 === 0) particles.push({ x: p1.x + d.w/2, y: p1.y + d.h, size: 5, life: 1, vx: (Math.random()-0.5), vy: 2, color: 'rgba(255,255,255,0.3)' });

        if(frames % 45 === 0) spawnEnemy();

        enemies.forEach((e, i) => {
            e.y += speed - e.v;
            if(e.type === 'POLICE' && e.y < p1.y) e.x += (e.x < p1.x ? 1.5 : -1.5);
            if(p1.alive && p1.x < e.x + e.w && p1.x + d.w > e.x && p1.y < e.y + e.h && p1.y + d.h > e.y) {
                shake = 20; 
                for(let j=0; j<15; j++) particles.push({ x: p1.x+20, y: p1.y, size: Math.random()*8, life: 1, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10, color: d.color });
                endGame();
            }
            if(e.y > 800) { enemies.splice(i, 1); credits += 5; }
        });

        // Particle Update
        particles.forEach((p, i) => { p.x += p.vx; p.y += p.vy; p.life -= 0.02; if(p.life <= 0) particles.splice(i, 1); });

        // Draw with Screen Shake
        ctx.save();
        if(shake > 0) { ctx.translate(Math.random()*shake - shake/2, Math.random()*shake - shake/2); shake *= 0.9; }
        
        ctx.fillStyle = "#050508"; ctx.fillRect(0,0,440,750);
        ctx.strokeStyle = "rgba(0, 242, 255, 0.05)";
        for(let i=0; i<5; i++) { ctx.beginPath(); ctx.moveTo(50+i*85, 0); ctx.lineTo(50+i*85, 750); ctx.stroke(); }
        
        particles.forEach(p => { ctx.globalAlpha = p.life; ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, p.size, p.size); ctx.globalAlpha = 1; });
        if(p1.alive) drawCar(ctx, p1.x, p1.y, currentCar, d.color);
        enemies.forEach(e => { drawCar(ctx, e.x, e.y, 'Specter', e.color); if(e.type === 'POLICE' && frames%20<10) { ctx.fillStyle = frames%10<5?'#f00':'#00f'; ctx.fillRect(e.x+5, e.y+5, 30, 5); } });
        
        ctx.restore();

        if(showDebug) { ctx.fillStyle="#0f0"; ctx.fillText(`FPS: 60 | VER: ${VERSION}`, 10, 85); }
        document.getElementById('score').innerText = Math.floor(score/10);
        document.getElementById('speedDisp').innerText = Math.floor(speed * 15) + " MPH";
        
        requestAnimationFrame(gameLoop);
    }

    function endGame() {
        gameState = 'MENU'; credits += Math.floor(score/10);
        localStorage.setItem('nitroCr', credits);
        setTimeout(() => { document.getElementById('ui').style.visibility='hidden'; openPanel('menu'); }, 500);
    }

    updateCurrencyUI();
</script>
</body>
</html>
