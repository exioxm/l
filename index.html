<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nitro Racer: Admin Edition</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #game-container { position: relative; width: 440px; height: 750px; }
        canvas { background: #020208; border: 2px solid #00f2ff; box-shadow: 0 0 50px rgba(0, 242, 255, 0.4); display: block; }
        
        #ui, .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff; }
        #ui { justify-content: flex-start; padding-top: 20px; visibility: hidden; }
        .overlay { pointer-events: auto; background: rgba(2, 2, 12, 0.95); }
        .hidden { display: none !important; }
        
        .stat-row { width: 380px; display: flex; justify-content: space-between; }
        .label { font-size: 10px; color: #00f2ff; text-transform: uppercase; }
        .val { font-size: 22px; font-weight: 900; text-shadow: 0 0 10px #00f2ff; font-family: monospace; }
        
        h1 { color: #00f2ff; font-size: 40px; margin: 0; font-style: italic; text-shadow: 0 0 20px #00f2ff; }
        .credits-info { margin: 10px 0 30px; font-family: monospace; color: #ffcc00; }
        
        .btn { width: 240px; padding: 12px; margin: 5px; background: rgba(0, 242, 255, 0.05); border: 1px solid #00f2ff; color: #00f2ff; font-weight: bold; cursor: pointer; transition: 0.2s; text-transform: uppercase; }
        .btn:hover { background: #00f2ff; color: #000; box-shadow: 0 0 20px #00f2ff; }
        
        .car-card { border: 1px solid #333; padding: 10px; cursor: pointer; text-align: center; font-size: 12px; }
        .car-card.selected { border-color: #00f2ff; box-shadow: 0 0 10px #00f2ff; }
        .color-row { display: flex; gap: 15px; margin: 20px 0; }
        .color-dot { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid #fff; }

        #admin-btn { position: absolute; top: 10px; right: 10px; font-size: 10px; cursor: pointer; color: #555; pointer-events: auto; }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>

    <div id="ui">
        <div class="stat-row">
            <div><div class="label">Distance</div><div class="val" id="score">0</div></div>
            <div><div class="label">MPH</div><div class="val" id="speedDisp">0</div></div>
            <div><div class="label">Credits</div><div class="val" id="creditsUI">0</div></div>
        </div>
        <div id="wanted" style="margin-top:10px; font-size:24px; color:#222; letter-spacing:5px;">
            <span id="s1">★</span><span id="s2">★</span><span id="s3">★</span><span id="s4">★</span><span id="s5">★</span>
        </div>
    </div>

    <div id="menu" class="overlay">
        <div id="admin-btn" onclick="checkAdmin()">ADMIN</div>
        <h1>NITRO RACER</h1>
        <div class="credits-info">CREDITS: <span id="crMenu">0</span></div>
        <button class="btn" onclick="startGame('NORMAL', 1)">Single Drive</button>
        <button class="btn" onclick="startGame('DUO', 2)">Duo Drive</button>
        <button class="btn" style="border-color:#ff0044; color:#ff0044;" onclick="openPanel('pursuit-menu')">Police Pursuit</button>
        <button class="btn" style="border-color:#fff; color:#fff;" onclick="openPanel('garage')">Customize Garage</button>
    </div>

    <div id="pursuit-menu" class="overlay hidden">
        <h1 style="color:#ff0044;">PURSUIT</h1>
        <p>SELECT UNIT COUNT</p>
        <button class="btn" onclick="startGame('PURSUIT', 1)">Solo Escape</button>
        <button class="btn" onclick="startGame('PURSUIT', 2)">Duo Escape</button>
        <button class="btn" onclick="openPanel('menu')">Back</button>
    </div>

    <div id="garage" class="overlay hidden">
        <h1>GARAGE</h1>
        <div class="credits-info">CREDITS: <span id="crGarage">0</span></div>
        <div class="garage-grid" id="carGrid"></div>
        <div class="color-row">
            <div class="color-dot" style="background:#00f2ff" onclick="setColor('#00f2ff')"></div>
            <div class="color-dot" style="background:#ff00ff" onclick="setColor('#ff00ff')"></div>
            <div class="color-dot" style="background:#ffff00" onclick="setColor('#ffff00')"></div>
            <div class="color-dot" style="background:#00ff00" onclick="setColor('#00ff00')"></div>
        </div>
        <button class="btn" onclick="openPanel('menu')">Save & Back</button>
    </div>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    
    let credits = parseInt(localStorage.getItem('nitroCr')) || 0;
    let highScore = localStorage.getItem('nitroHigh') || 0;
    let unlockedCars = JSON.parse(localStorage.getItem('nitroCars')) || ['Specter'];
    let currentCar = localStorage.getItem('nitroActiveCar') || 'Specter';
    let p1Color = localStorage.getItem('nitroColor') || '#00f2ff';
    let isAdmin = false;

    const carData = {
        'Specter': { w: 42, h: 84, price: 0, desc: 'Balanced' },
        'Interceptor': { w: 34, h: 90, price: 5000, desc: 'Slim & Fast' },
        'Goliath': { w: 52, h: 80, price: 10000, desc: 'Heavy Tank' },
        'Rainbow': { w: 45, h: 88, price: 99999, desc: 'ADMIN ONLY', admin: true }
    };

    let gameState = 'START', gameMode = 'NORMAL', playerCount = 1;
    let score = 0, targetSpeed = 8, frames = 0, enemies = [], keys = {};
    const p1 = { x: 200, y: 580, alive: true }, p2 = { x: 280, y: 580, alive: true };

    function checkAdmin() {
        const password = prompt("Enter Admin Password:");
        if (password === '123') {
            isAdmin = true;
            credits = 99999;
            if (!unlockedCars.includes('Rainbow')) unlockedCars.push('Rainbow');
            localStorage.setItem('nitroCr', credits);
            localStorage.setItem('nitroCars', JSON.stringify(unlockedCars));
            alert("ADMIN ACCESS GRANTED! Rainbow car unlocked and credits maxed.");
            updateCurrencyUI();
            renderGarage();
        } else {
            alert("ACCESS DENIED.");
        }
    }

    function updateCurrencyUI() {
        document.getElementById('crMenu').innerText = credits;
        document.getElementById('crGarage').innerText = credits;
        document.getElementById('creditsUI').innerText = credits;
    }
    updateCurrencyUI();

    window.addEventListener("keydown", (e) => keys[e.code] = true);
    window.addEventListener("keyup", (e) => keys[e.code] = false);

    function openPanel(id) {
        document.querySelectorAll('.overlay').forEach(p => p.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        if(id === 'garage') renderGarage();
    }

    function renderGarage() {
        const grid = document.getElementById('carGrid');
        grid.innerHTML = '';
        for(let name in carData) {
            const data = carData[name];
            const isUnlocked = unlockedCars.includes(name);
            const card = document.createElement('div');
            card.className = `car-card ${currentCar === name ? 'selected' : ''}`;
            card.innerHTML = `<b>${name}</b><br>${data.desc}<br>${isUnlocked ? '(OWNED)' : '<span style="color:#ffcc00">$' + data.price + '</span>'}`;
            card.onclick = () => {
                if(isUnlocked) {
                    currentCar = name;
                    localStorage.setItem('nitroActiveCar', name);
                    renderGarage();
                } else if (credits >= data.price) {
                    credits -= data.price;
                    unlockedCars.push(name);
                    localStorage.setItem('nitroCr', credits);
                    localStorage.setItem('nitroCars', JSON.stringify(unlockedCars));
                    updateCurrencyUI();
                    renderGarage();
                }
            };
            grid.appendChild(card);
        }
    }

    function setColor(c) { p1Color = c; localStorage.setItem('nitroColor', c); }

    function startGame(mode, count) {
        gameMode = mode; playerCount = count; gameState = 'PLAYING';
        score = 0; targetSpeed = 8; enemies = [];
        p1.x = playerCount === 2 ? 120 : 200; p1.alive = true;
        p2.x = 280; p2.alive = playerCount === 2;
        document.querySelectorAll('.overlay').forEach(p => p.classList.add('hidden'));
        document.getElementById('ui').style.visibility = 'visible';
    }

    // Car Drawing function uses currentCar variable to draw the correct shape
    function drawCar(x, y, color, carName, type) {
        const d = carData[carName] || carData['Specter'];
        ctx.save();
        
        let displayColor = color;
        if (carName === 'Rainbow') {
            const colors = ['#ff0000', '#ffff00', '#00ff00', '#00ffff', '#0000ff', '#ff00ff'];
            displayColor = colors[Math.floor(frames / 5) % colors.length];
        }

        ctx.shadowBlur = 15; ctx.shadowColor = displayColor;
        ctx.strokeStyle = displayColor; ctx.lineWidth = 2;
        ctx.beginPath();
        if(carName === 'Specter' || carName === 'Rainbow') {
            ctx.moveTo(x + d.w/2, y); ctx.lineTo(x + d.w, y + d.h*0.3); ctx.lineTo(x + d.w*0.8, y + d.h*0.9); ctx.lineTo(x + d.w*0.2, y + d.h*0.9); ctx.lineTo(x, y + d.h*0.3);
        } else if(carName === 'Interceptor') {
            ctx.moveTo(x + d.w/2, y); ctx.lineTo(x + d.w, y + d.h); ctx.lineTo(x, y + d.h);
        } else if (carName === 'Goliath') {
            ctx.rect(x, y, d.w, d.h);
        }
        ctx.closePath(); ctx.fillStyle = "#050505"; ctx.fill(); ctx.stroke();
        if(type === 'police') {
            ctx.fillStyle = (Math.floor(frames/8)%2) ? "#ff0044" : "#00aaff";
            ctx.fillRect(x + d.w*0.2, y + 5, d.w*0.6, 5);
        }
        ctx.restore();
    }

    function update() {
        if(gameState !== 'PLAYING') return;
        frames++;
        
        let throttle = (keys['KeyW'] || keys['ArrowUp']) ? 0.08 : (keys['KeyS'] || keys['ArrowDown']) ? -0.12 : -0.02;
        targetSpeed = Math.max(5, Math.min(15, targetSpeed + throttle));
        
        score += Math.floor(targetSpeed * 0.1);
        credits += Math.floor(targetSpeed * 0.01); // Minor credit gain while driving
        document.getElementById('score').innerText = score;
        document.getElementById('speedDisp').innerText = Math.floor(targetSpeed * 15);
        updateCurrencyUI();

        // Steering
        const speedMult = 8;
        const p1Dims = carData[currentCar];
        const p2Dims = carData[currentCar];
        if(p1.alive) {
            if(keys['KeyA']) p1.x -= speedMult; if(keys['KeyD']) p1.x += speedMult;
            p1.x = Math.max(10, Math.min(canvas.width - p1Dims.w - 10, p1.x));
        }
        if(p2.alive && playerCount === 2) {
            if(keys['ArrowLeft']) p2.x -= speedMult; if(keys['ArrowRight']) p2.x += speedMult;
            p2.x = Math.max(10, Math.min(canvas.width - p2Dims.w - 10, p2.x));
        }

        // Enemies
        if (frames % 35 === 0) {
            enemies.push({ x: 30 + Math.random() * 350, y: -100, w: 40, h: 80, isPolice: gameMode === 'PURSUIT' });
        }

        enemies.forEach((e, i) => {
            e.y += targetSpeed + 2;
            if(e.y > canvas.height) enemies.splice(i, 1);
            
            // Collision check uses the correct car dimensions
            if(p1.alive) {
                if(p1.x < e.x + e.w && p1.x + p1Dims.w > e.x && p1.y < e.y + e.h && p1.y + p1Dims.h > e.y) p1.alive = false;
            }
            if(p2.alive && playerCount === 2) {
                if(p2.x < e.x + e.w && p2.x + p2Dims.w > e.x && p2.y < e.y + e.h && p2.y + p2Dims.h > e.y) p2.alive = false;
            }
        });

        if(!p1.alive && (!p2.alive || playerCount === 1)) endGame();
    }

    function draw() {
        ctx.fillStyle = "#020208"; ctx.fillRect(0, 0, canvas.width, canvas.height);
        if(gameState === 'PLAYING') {
            enemies.forEach(e => drawCar(e.x, e.y, e.isPolice ? "#00aaff" : "#ff0044", 'Specter', e.isPolice ? 'police' : 'traffic'));
            if(p1.alive) drawCar(p1.x, p1.y, p1Color, currentCar, 'player');
            if(p2.alive && playerCount === 2) drawCar(p2.x, p2.y, "#ffcc00", currentCar, 'player');
        }
        update(); requestAnimationFrame(draw);
    }

    function endGame() {
        localStorage.setItem('nitroCr', credits);
        if(score > highScore) localStorage.setItem('nitroHigh', score);
        gameState = 'START'; 
        document.getElementById('ui').style.visibility = 'hidden';
        openPanel('menu');
    }
    draw();
</script>
</body>
</html>
